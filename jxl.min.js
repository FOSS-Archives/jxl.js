!function(){"use strict";let e={useCache:!0,compressCache:!1},t=function(){var e=Array(15);function t(e,t){return 506832829*e>>>t}function r(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function a(e,t,r){return e[t]===e[r]&&e[t+1]===e[r+1]&&e[t+2]===e[r+2]&&e[t+3]===e[r+3]}function n(e,t,r,a,n){var i;for(i=0;i<n;i++)r[a+i]=e[t+i]}function i(e,t,r,a,i){return r<=60?(a[i]=r-1<<2,i+=1):r<256?(a[i]=240,a[i+1]=r-1,i+=2):(a[i]=244,a[i+1]=r-1&255,a[i+2]=r-1>>>8,i+=3),n(e,t,a,i,r),i+r}function s(e,t,r,a){return a<12&&r<2048?(e[t]=1+(a-4<<2)+(r>>>8<<5),e[t+1]=255&r,t+2):(e[t]=2+(a-1<<2),e[t+1]=255&r,e[t+2]=r>>>8,t+3)}function o(e,t,r,a){for(;a>=68;)t=s(e,t,r,64),a-=64;return a>64&&(t=s(e,t,r,60),a-=60),s(e,t,r,a)}function c(n,s,c,h,f){for(var u,_,d,l,g,p,m,w,$,v,A,y,b,x=1;1<<x<=c&&x<=14;)x+=1;var C=32-(x-=1);void 0===e[x]&&(e[x]=new Uint16Array(1<<x));var j=e[x];for(u=0;u<j.length;u++)j[u]=0;var E=s+c,k=s,B=s,I=!0;if(c>=15)for(_=E-15,s+=1,l=t(r(n,s),C);I;){m=32,g=s;do{if(s=g,d=l,w=m>>>5,m+=1,g=s+w,s>_){I=!1;break}l=t(r(n,g),C),p=k+j[d],j[d]=s-k}while(!a(n,s,p));if(!I)break;f=i(n,B,s-B,h,f);do{for($=s,v=4;s+v<E&&n[s+v]===n[p+v];)v+=1;if(s+=v,f=o(h,f,A=$-p,v),B=s,s>=_){I=!1;break}j[y=t(r(n,s-1),C)]=s-1-k,b=t(r(n,s),C),p=k+j[b],j[b]=s-k}while(a(n,s,p));if(!I)break;s+=1,l=t(r(n,s),C)}return B<E&&(f=i(n,B,E-B,h,f)),f}function h(e){this.array=e}h.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},h.prototype.compressToBuffer=function(e){var t,r=this.array,a=r.length,n=0,i=0;for(i=function e(t,r,a){do r[a]=127&t,(t>>>=7)>0&&(r[a]+=128),a+=1;while(t>0);return a}(a,e,i);n<a;)t=Math.min(a-n,65536),i=c(r,n,t,e,i),n+=t;return i};var f=[0,255,65535,16777215,4294967295];function n(e,t,r,a,n){var i;for(i=0;i<n;i++)r[a+i]=e[t+i]}function u(e,t,r,a){var n;for(n=0;n<a;n++)e[t+n]=e[t-r+n]}function _(e){this.array=e,this.pos=0}return _.prototype.readUncompressedLength=function(){for(var e,t,r=0,a=0;a<32&&this.pos<this.array.length&&(e=this.array[this.pos],this.pos+=1,(t=127&e)<<a>>>a===t);){if(r|=t<<a,e<128)return r;a+=7}return -1},_.prototype.uncompressToBuffer=function(e){for(var t,r,a,i,s=this.array,o=s.length,c=this.pos,h=0;c<s.length;)if(t=s[c],c+=1,(3&t)==0){if((r=(t>>>2)+1)>60){if(c+3>=o)return!1;a=r-60,r=((r=s[c]+(s[c+1]<<8)+(s[c+2]<<16)+(s[c+3]<<24))&f[a])+1,c+=a}if(c+r>o)return!1;n(s,c,e,h,r),c+=r,h+=r}else{switch(3&t){case 1:r=(t>>>2&7)+4,i=s[c]+(t>>>5<<8),c+=1;break;case 2:if(c+1>=o)return!1;r=(t>>>2)+1,i=s[c]+(s[c+1]<<8),c+=2;break;case 3:if(c+3>=o)return!1;r=(t>>>2)+1,i=s[c]+(s[c+1]<<8)+(s[c+2]<<16)+(s[c+3]<<24),c+=4}if(0===i||i>h)return!1;u(e,h,i,r),h+=r}return!0},{compress:function e(t){var r,a,n=new h(t),i=n.maxCompressedLength();return r=new Uint8ClampedArray(i),a=n.compressToBuffer(r),r.slice(0,a)},uncompress:function e(t,r){var a,n=new _(t),i=n.readUncompressedLength();if(-1===i)throw Error("Invalid Snappy bitstream");if(i>r)throw Error(`The uncompressed length of ${i} is too big, expect at most ${r}`);if(a=new Uint8ClampedArray(i),!n.uncompressToBuffer(a))throw Error("Invalid Snappy bitstream");return a}}}(),r;function a(e,t){if("OffscreenCanvas"in window){let r=new OffscreenCanvas(t.width,t.height),a=new Worker("jxl_dec.js");a.postMessage({canvas:r,imgData:t},[r]),a.addEventListener("message",t=>{e.style.backgroundImage='url("'+t.data.url+'")'})}else{let n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e.style.backgroundImage='url("'+n.toDataURL()+'")'}}async function n(e,t){let r=document.createElement("canvas");r.width=1===e.width?t.width:e.width,r.height=1===e.height?t.height:e.height,r.className=e.className,r.id=e.id,r.title=e.title,r.dataset.jxlSrc=e.dataset.jxlSrc;let a=await window.createImageBitmap(t,{resizeWidth:r.width,resizeHeight:r.height});r.getContext("2d").drawImage(a,0,0),e.replaceWith(r)}async function i(i,s){let o=s?getComputedStyle(i).backgroundImage.slice(5,-2):i.dataset.jxlSrc=i.currentSrc;i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";try{r=e.useCache&&(r||await caches.open("jxl"))}catch(c){}let h=r&&await r.match(o);if(h){let f=new Uint8ClampedArray(await h.arrayBuffer()),u=e.compressCache?t.uncompress(f):f,_=new ImageData(u,h.headers.get("width"),h.headers.get("height"));requestAnimationFrame(()=>s?a(i,_):n(i,_));return}let d=await fetch(o),l=await d.arrayBuffer(),g=new Worker("jxl_dec.js");g.postMessage({jxlSrc:o,image:l},[l]),g.addEventListener("message",c=>{let h=c.data.imgData;if(requestAnimationFrame(()=>s?a(i,h):n(i,h)),e.useCache){let f=e.compressCache?t.compress(h.data):h.data;r&&r.put(o,new Response(f,{headers:{"content-type":"image/jxl",width:h.width,height:h.height}}))}})}new MutationObserver(e=>{e.forEach(e=>{Array.prototype.filter.call(e.addedNodes,e=>e instanceof HTMLImageElement&&e.src.endsWith(".jxl")||e instanceof Element&&getComputedStyle(e).backgroundImage.endsWith('.jxl")')).forEach(e=>{e instanceof HTMLImageElement?e.onerror=()=>i(e,!1):i(e,!0)})})}).observe(document.documentElement,{subtree:!0,childList:!0})}();